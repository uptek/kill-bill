Most billing system are batch oriented: Invoice calculation occurs at certain specific times (often configurable), and the system goes through all accounts and generate the missing invoices.
Kill Bill, on the other hand, generates new invoices as soon as there is a change in the system that requires such a new invoice. This may occur, for example:

* when there is a change to a subscription (creation, change of plan, cancellation, etc.)
* when the system detects a recurring charge is due (e.g. monthly recurring subscriptions)
* when an operator creates an external charge, adjusts a past invoice or triggers a future invoice

After an invoice has been generated, its balance is positive or zero.
If it is positive, the customer owes money and needs to pay the balance.
Each time an invoice would become negative, the system automatically inserts a special item, called credit balance adjustment (CBA), to bring the balance back to zero.
That credit is automatically added to the account and used on future invoices.
If the invoice is paid, a payment is added against that invoice.
If the invoice is adjusted later on, a CBA item will be automatically generated and appear on the invoice.
Kill Bill invoices are for the most part static, with the exceptions of manual changes (manual credit, charge added on a specific invoice after generation).

An invoice is composed of invoice items. The various types of invoice items are:

* RECURRING: Recurring charge. Used for items with a billing period. This item is always positive or zero
* FIXED: Fixed (one-time) charge. Used for items without a billing period (non recurring phase, e.g. trials). This item is always positive or zero
* EXTERNAL_CHARGE: Fixed (one-time) external charge, for items not in the catalog. This item is always positive
* USAGE: Usage charge. This item is always positive or zero.
* TAX: Tax item. This item is not added by the core system, but is added by tax plugins -- when such plugins exist.
* ITEM_ADJ: Invoice item adjustment, generated by an operator (often associated with a refund). This item is always negative
* CREDIT_ADJ: Invoice level adjustment (credits), either at the account level (on its own invoice) or against an existing invoice. This item is always negative
* REPAIR_ADJ: Internal adjustment, generated automatically by the system for an invoice on which the subscription was modified (immediate cancellation or change). The items is always negative
* CBA_ADJ: Internal adjustment, generated automatically by the system for an invoice which became negative (account level credits). Positive when generating credits, negative when consuming account level credits. The sum of CBA items for an account should always be positive or zero

Recurring invoice items start and end on the same day of the month.
For example, a monthly subscription starting on the 21st will have items for the service period 2012-08-21 to 2012-09-21, 2012-09-21 to 2012-10-21, etc.
Fixed items only have a start date and never get prorated.

==== Invoice and Account Balance

The invoice balance is computed by adding all the charges, subtracting credits and adjustments, and then subtracting the amount paid.

* The charge amount is computed from the following items: FIXED, RECURRING, EXTERNAL_CHARGE, REPAIR_ADJ, ITEM_ADJ, USAGE, TAX.
* The resulting paid amount is equal to the original paid amount after subtracting any refund amount.

The invoice balance is zero in the following cases:

* When the invoice was tagged with the WRITTEN_OFF tag.
* When the invoice is in DRAFT mode.
* When this is a migration invoice (imported in the system).
* When this is a child invoice for which the parent summary invoice has been fully paid (HA feature).

The account balance is the sum of all the invoice balances after subtracting any account credit. For example, if all invoices were fully paid, and if there was a $10 account credit, the account balance would be negative and equal to -$10.



